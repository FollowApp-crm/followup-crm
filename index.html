<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Follow-up CRM</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== Header ===== -->
  <header>
    <div class="wrap">
      <div class="grid" style="grid-template-columns:1fr auto; align-items:center;">
        <div>
          <h1>Follow-up CRM</h1>
          <div class="sub">Lightweight customers + follow-ups</div>
        </div>
        <div class="right">
          <button id="themeToggle" class="toggle" type="button">‚òÄÔ∏è Light</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">

      <!-- ===== KPIs ===== -->
      <section class="kpi">
        <div class="box"><div class="tiny">Customers</div><div class="num" id="kTotal">0</div></div>
        <div class="box"><div class="tiny">Unreached</div><div class="num" id="kUn">0</div></div>
        <div class="box"><div class="tiny">Reached</div><div class="num" id="kRe">0</div></div>
        <div class="box"><div class="tiny">Open Tasks</div><div class="num" id="kTasks">0</div></div>
      </section>

      <!-- ===== Customers ===== -->
      <section class="card">
        <div class="hd">
          <strong>Customers</strong>
          <span class="space"></span>
          <input id="search" type="search" placeholder="Search‚Ä¶" />
          <select id="statusFilter" title="Filter status">
            <option value="">All</option>
            <option value="unreached">Unreached</option>
            <option value="reached">Reached</option>
          </select>
          <button id="openAdd" class="add-btn" title="Add customer" aria-label="Add customer">+</button>
        </div>
        <div class="bd customers-scroll">
          <table class="tbl" id="clientsTbl">
            <thead>
              <tr>
                <th style="width:28%">Name</th>
                <th style="width:28%">Contact</th>
                <th style="width:12%">Status</th>
                <th style="width:16%">Next Action</th>
                <th style="width:16%">Actions</th>
              </tr>
            </thead>
            <tbody><!-- populated by JS --></tbody>
          </table>
        </div>
      </section>

      <!-- ===== Actions + Agenda + Calendar (two-column) ===== -->
      <section class="row agenda-layout">

        <!-- === LEFT: Actions + Agenda === -->
        <div id="actionsCard" class="card">
          <div class="hd toolbar">

            <!-- Show group -->
            <span class="pill tiny mono">Show:</span>
            <div id="showGroup" class="seg">
              <button id="showAll" type="button">All</button>
              <button id="showOpen" type="button">Incomplete</button>
              <button id="showDone" type="button">Complete</button>
            </div>

            <!-- Sort group (explicit wrapper so it matches Show) -->
            <div id="sortWrap" class="toolbar">
              <span id="sortLabel" class="pill tiny mono">Sort:</span>
              <div id="sortGroup" class="seg">
                <button id="sortClient" type="button">By client</button>
                <button id="sortType" type="button">By task</button>
              </div>
            </div>

            <!-- View mode -->
            <div class="seg" style="margin-left:8px;">
              <button id="viewToday" type="button">Today</button>
              <button id="viewWeek"  type="button">Next 7 days</button>
            </div>

            <!-- Date jump -->
            <input id="agendaDate" type="date" title="Jump to date" style="width:150px" />

            <!-- Filter by client name -->
            <input id="agendaFilter" type="search" placeholder="Filter by client‚Ä¶" style="min-width:180px" />
            <button id="agendaFilterClear" class="btn-icon" title="Clear filter" aria-label="Clear filter">‚úñÔ∏è</button>

            <span class="space"></span>

            <!-- Quick actions -->
            <button id="sendDueEmails" class="ghost" type="button">Batch email (Unreached today)</button>
            <button id="addTaskBtn" class="primary" type="button">+ Add Task</button>
          </div>

          <div class="bd">
            <!-- Progress -->
            <div class="flex-row" style="margin-bottom:8px;">
              <span class="tiny mono">Today&rsquo;s progress:</span>
              <div class="progress" style="flex:1; max-width:420px;">
                <span id="progressBar" style="width:0%"></span>
              </div>
              <span id="progressPct" class="tiny mono">0%</span>
            </div>

            <!-- Notifications (enable/test) -->
            <div class="slab flex-row" style="margin-bottom:10px;">
              <span class="tiny mono">Notifications:</span>
              <button id="enableNotifs" type="button">üîî Enable</button>
              <button id="testNotif" type="button">Test</button>
              <span class="tiny mono">Status: <span id="notifStatus">Not enabled</span></span>
            </div>

            <!-- Agenda list -->
            <div id="agenda"><div class="tiny">No tasks yet.</div></div>
          </div>
        </div>

        <!-- === RIGHT: Calendar === -->
        <div id="calendarCard" class="card">
          <div class="hd">
            <div class="cal-hd" style="width:100%;">
              <button id="calPrev" class="btn-icon" type="button" title="Prev month" aria-label="Prev month">‚óÄ</button>
              <span class="space"></span>
              <strong id="calTitle">‚Äî</strong>
              <span class="space"></span>
              <button id="calNext" class="btn-icon" type="button" title="Next month" aria-label="Next month">‚ñ∂</button>
            </div>
            <span class="space"></span>
            <button id="calSettingsBtn" class="settings-btn" type="button">Calendar settings</button>
          </div>
          <div class="bd">
            <div id="calendarGrid"><!-- built by JS --></div>

            <!-- Settings panel -->
            <div id="calSettings" style="display:none;">
              <div class="tiny" style="margin-bottom:8px;">Working days</div>
              <div class="wdays">
                <label class="cell"><input id="wd_mon" type="checkbox" /><span>Mon</span></label>
                <label class="cell"><input id="wd_tue" type="checkbox" /><span>Tue</span></label>
                <label class="cell"><input id="wd_wed" type="checkbox" /><span>Wed</span></label>
                <label class="cell"><input id="wd_thu" type="checkbox" /><span>Thu</span></label>
                <label class="cell"><input id="wd_fri" type="checkbox" /><span>Fri</span></label>
                <label class="cell"><input id="wd_sat" type="checkbox" /><span>Sat</span></label>
                <label class="cell"><input id="wd_sun" type="checkbox" /><span>Sun</span></label>
              </div>

              <label class="toggle" style="margin-top:10px; display:inline-flex; align-items:center; gap:8px;">
                <input id="moveOffDays" type="checkbox" /> Move auto tasks off non-working days
              </label>

              <!-- Date-specific overrides -->
              <div class="ovr">
                <input id="ovrDate" type="date" />
                <select id="ovrType">
                  <option value="off">Mark Off</option>
                  <option value="work">Mark Working</option>
                </select>
                <button id="addOverride" type="button">Add Override</button>
                <span class="space"></span>
                <button id="saveCalSettings" class="primary" type="button">Save</button>
              </div>

              <ul id="overrideList" class="ovr-list"><!-- populated by JS --></ul>
            </div>
          </div>
        </div>

      </section>
    </div>
  </main>

  <!-- ===== Add/Edit Customer (moved into .modal by JS) ===== -->
  <section id="addCard" class="card" style="display:none;">
    <div class="hd">
      <strong>Add / Edit Customer</strong>
      <span class="space"></span>
      <button id="closeAdd" class="btn-icon" type="button" title="Close" aria-label="Close">‚úñÔ∏è</button>
    </div>
    <div class="bd">
      <!-- Quick paste block -->
      <div class="lead-block">
        <label for="leadBlob">Paste a lead (auto-parse):</label>
        <textarea id="leadBlob" placeholder="Paste text here‚Ä¶"></textarea>
      </div>

      <form id="clientForm">
        <input type="hidden" id="clientId" />

        <div class="row">
          <div>
            <label for="name">Name</label>
            <input id="name" type="text" placeholder="Customer name" />
          </div>
          <div>
            <label for="status">Status</label>
            <select id="status">
              <option value="unreached">Unreached</option>
              <option value="reached">Reached</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="name@example.com" />
          </div>
          <div>
            <label for="phone">Phone</label>
            <input id="phone" type="tel" placeholder="+1 555 123 4567" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="startDate">Start date (anchor)</label>
            <input id="startDate" type="date" />
          </div>
          <div>
            <label for="route">Route</label>
            <input id="route" type="text" placeholder="ABC-DEF" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="dates">Dates</label>
            <input id="dates" type="text" placeholder="Mar 2‚Äì7, 2025" />
          </div>
          <div>
            <label for="pax">Pax</label>
            <input id="pax" type="text" placeholder="2" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="leadId">Lead ID</label>
            <input id="leadId" type="text" placeholder="123456" />
          </div>
          <div>
            <label>&nbsp;</label>
            <span class="pill tiny mono">Auto-schedule tasks per status</span>
          </div>
        </div>

        <div class="row single">
          <div>
            <label for="notes">Notes</label>
            <textarea id="notes" placeholder="Freeform notes‚Ä¶"></textarea>
          </div>
        </div>

        <!-- Sticky footer -->
        <div class="form-footer">
          <button id="resetForm" type="button" class="ghost">Reset</button>
          <button id="saveCustomer" type="button" class="primary">Save</button>
        </div>
      </form>
    </div>
  </section>

  <!-- ===== Custom Task Modal (sheet-style) ===== -->
  <div id="customTaskPop" style="display:none;">
    <div class="sheet">
      <div class="hd" style="display:flex; align-items:center; gap:8px;">
        <strong>Add Custom Task</strong>
        <span class="space"></span>
        <button id="ctClose" class="btn-icon" type="button" title="Close">‚úñÔ∏è</button>
      </div>
      <div class="bd">
        <div class="row">
          <div>
            <label for="ctClient">Client (optional)</label>
            <select id="ctClient"><option value="">Loading‚Ä¶</option></select>
          </div>
          <div>
            <label for="ctType">Type</label>
            <select id="ctType">
              <option value="call">Call</option>
              <option value="callvm">Call + Voicemail</option>
              <option value="sms">SMS</option>
              <option value="email">Email</option>
              <option value="custom">Custom</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="ctTitle">Title</label>
            <input id="ctTitle" type="text" placeholder="Task title" />
          </div>
          <div>
            <label for="ctDate">Date</label>
            <input id="ctDate" type="date" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="ctTime">Time (optional)</label>
            <input id="ctTime" type="time" />
          </div>
          <div class="flex-row" style="align-items:center; margin-top:22px;">
            <label class="toggle"><input id="ctNotify" type="checkbox" /> Notify at time</label>
            <label class="toggle"><input id="ctImportant" type="checkbox" /> Mark important</label>
          </div>
        </div>

        <div class="row single">
          <div>
            <label for="ctNotes">Notes</label>
            <textarea id="ctNotes" placeholder="Optional details‚Ä¶"></textarea>
          </div>
        </div>

        <div class="right" style="margin-top:8px;">
          <button id="ctCancel" type="button">Cancel</button>
          <button id="ctSave" class="primary" type="button">Save Task</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Optional toaster host (JS will create if missing) -->
  <div id="toaster" style="display:none;"></div>

  <!-- App JS -->
  <script src="app.js"></script>
</body>
</html>
